services:
  whatsapp-tickets-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whatsapp-tickets-server
    ports:
      - "8523:8523"
    environment:
      # Configuración de conexión con la máquina del puente
      IP_LAPTOP: "172.16.12.100"
      PUERTO_LAPTOP: "9000"

      # Token de autenticación (DEBE SER IGUAL en whatsapp-bridge.js)
      API_TOKEN: "1234567890"

      # Configuración de DeepSeek IA (IMPORTANTE: agregar tu API Key)
      DEEPSEEK_API_KEY: "${DEEPSEEK_API_KEY}"
      DEEPSEEK_MODEL: "deepseek-chat"
      DEEPSEEK_MAX_TOKENS: "2000"

      # Configuración de sesiones y carpetas
      SESSION_TIMEOUT_MINUTES: "15"
      CARPETA_FOTOS: "fotos_evidencia"
      CARPETA_LOGS: "logs_conversaciones"
      MAX_IMAGE_SIZE: "16000000"

      # Orígenes CORS permitidos
      ALLOWED_ORIGINS: "*"

      # Python settings
      PYTHONUNBUFFERED: "1"

    volumes:
      # Volúmenes para persistencia de datos
      - ./fotos_evidencia:/app/fotos_evidencia
      - ./logs_conversaciones:/app/logs_conversaciones
      - ./tickets.db:/app/tickets.db

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8523/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    restart: unless-stopped

    networks:
      - whatsapp-tickets-network

networks:
  whatsapp-tickets-network:
    driver: bridge
